import React, { useState } from 'react';
import Svg, {
  Path,
  Rect,
  Defs,
  Pattern,
  Image,
  Mask,
  G,
  Use,
  Filter,
  FeBlend,
  FeFlood,
  FeColorMatrix,
  FeOffset,
  FeGaussianBlur,
  FeComposite,
} from 'react-native-svg';
import { Pressable, StyleSheet, View, Text, ScrollView } from 'react-native';
import Movie from '../../type/movie';

type ImageMaskViewerProps = {
  movie?: Movie;
};

const ImageMaskViewer = ({ movie }: ImageMaskViewerProps) => {
  const [displayMode, setDisplayMode] = useState<'poster' | 'detail'>('poster');

  return (
    <View>
      <Pressable
        style={{ zIndex: 2 }}
        onPress={() => {
          setDisplayMode(displayMode === 'poster' ? 'detail' : 'poster');
        }}
      >
        <Svg
          width="340"
          height="566"
          viewBox="0 0 340 566"
          fill="none"
          style={{
            position: 'relative',
          }}
        >
          <Defs>
            <Filter
              id="filter0_dd_4758_712"
              x="0.00021553"
              y="-0.00149155"
              width="339.674"
              height="565.329"
              filterUnits="userSpaceOnUse"
            >
              <FeFlood floodOpacity="0" result="BackgroundImageFix" />
              <FeColorMatrix
                in="SourceAlpha"
                type="matrix"
                values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                result="hardAlpha"
              />
              <FeOffset dx="0.998781" />
              <FeGaussianBlur stdDeviation="8.98903" />
              <FeComposite in2="hardAlpha" operator="out" />
              <FeColorMatrix
                type="matrix"
                values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0"
              />
              <FeBlend
                mode="multiply"
                in2="BackgroundImageFix"
                result="effect1_dropShadow_4758_712"
              />
              <FeColorMatrix
                in="SourceAlpha"
                type="matrix"
                values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                result="hardAlpha"
              />
              <FeOffset dy="3.99512" />
              <FeGaussianBlur stdDeviation="9.48842" />
              <FeComposite in2="hardAlpha" operator="out" />
              <FeColorMatrix
                type="matrix"
                values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.35 0"
              />
              <FeBlend
                mode="normal"
                in2="effect1_dropShadow_4758_712"
                result="effect2_dropShadow_4758_712"
              />
              <FeBlend
                mode="normal"
                in="SourceGraphic"
                in2="effect2_dropShadow_4758_712"
                result="shape"
              />
            </Filter>
            <Pattern
              id="pattern0_4758_712"
              patternContentUnits="objectBoundingBox"
              width="1"
              height="1"
            >
              <Use
                xlinkHref="#image0_4758_712"
                transform="matrix(0.00121536 0 0 0.000699301 -0.10768 0)"
              />
            </Pattern>
            <Image
              id="image0_4758_712"
              width="1000"
              height="1430"
              preserveAspectRatio="none"
              xlinkHref={
                displayMode === 'poster'
                  ? movie?.url
                  : require('@assets/images/background_blue.png')
              }
            />
            <Mask
              id="mask0_4758_712"
              maskUnits="userSpaceOnUse"
              x="18"
              y="17"
              width="303"
              height="526"
            >
              <Path
                d="M46.4751 22.7998C46.4751 27.4017 50.2063 31.1328 54.8081 31.1328C59.4098 31.1327 63.1401 27.4016 63.1401 22.7998V18.9753C63.1401 18.4237 63.5873 17.9766 64.1389 17.9766H74.4207C74.9723 17.9766 75.4194 18.4237 75.4194 18.9753V22.7998C75.4194 27.4017 79.1506 31.1328 83.7524 31.1328C88.3541 31.1326 92.0845 27.4015 92.0845 22.7998V18.9753C92.0845 18.4237 92.5316 17.9766 93.0833 17.9766H103.365C103.917 17.9766 104.364 18.4237 104.364 18.9753V22.8008C104.364 27.4025 108.095 31.1328 112.697 31.1328C117.298 31.1326 121.029 27.4024 121.029 22.8008V18.9753C121.029 18.4237 121.476 17.9766 122.028 17.9766H132.309C132.861 17.9766 133.308 18.4237 133.308 18.9753V22.8008C133.308 27.4025 137.039 31.1328 141.641 31.1328C146.243 31.1327 149.973 27.4024 149.973 22.8008V18.9753C149.973 18.4237 150.42 17.9766 150.972 17.9766H161.254C161.805 17.9766 162.252 18.4237 162.252 18.9753V22.8008C162.253 27.4025 165.983 31.1328 170.584 31.1328C175.186 31.1327 178.916 27.4025 178.917 22.8008V18.9753C178.917 18.4237 179.364 17.9766 179.915 17.9766H190.198C190.75 17.9766 191.197 18.4237 191.197 18.9753V22.8008C191.197 27.4024 194.927 31.1326 199.529 31.1328C204.131 31.1328 207.862 27.4025 207.862 22.8008V18.9753C207.862 18.4237 208.309 17.9766 208.861 17.9766H219.142C219.694 17.9766 220.141 18.4237 220.141 18.9753V22.8008C220.141 27.4025 223.871 31.1328 228.473 31.1328C233.075 31.1328 236.805 27.4025 236.805 22.8008V18.9753C236.805 18.4237 237.252 17.9766 237.804 17.9766H248.086C248.637 17.9766 249.084 18.4237 249.084 18.9753V22.8008C249.085 27.4025 252.816 31.1328 257.417 31.1328C262.019 31.1326 265.749 27.4024 265.75 22.8008V18.9753C265.75 18.4237 266.197 17.9766 266.748 17.9766H277.03C277.582 17.9766 278.029 18.4237 278.029 18.9753V22.8008C278.029 27.4025 281.76 31.1328 286.362 31.1328C290.963 31.1327 294.694 27.4024 294.694 22.8008V18.9753C294.694 18.4237 295.141 17.9766 295.693 17.9766H307.401C307.877 17.9766 308.251 18.3779 308.251 18.8535V34.6416C308.252 41.5489 313.242 47.2896 319.814 48.4569C320.314 48.5458 320.698 48.9693 320.698 49.4776V510.976C320.698 511.485 320.314 511.908 319.814 511.997C313.242 513.165 308.251 518.906 308.251 525.813V541.602C308.251 542.012 307.926 542.356 307.516 542.356H295.617C295.066 542.356 294.619 541.909 294.619 541.358V537.654C294.619 533.052 290.888 529.321 286.287 529.321C281.685 529.321 277.955 533.052 277.955 537.654V541.358C277.955 541.909 277.507 542.356 276.956 542.356H266.673C266.121 542.356 265.674 541.909 265.674 541.358V537.654C265.674 533.052 261.944 529.321 257.342 529.321C252.74 529.321 249.01 533.052 249.01 537.654V541.358C249.01 541.909 248.563 542.356 248.011 542.356H237.729C237.177 542.356 236.73 541.909 236.73 541.358V537.654C236.73 533.052 233 529.322 228.398 529.322C223.796 529.322 220.066 533.052 220.066 537.654V541.358C220.066 541.909 219.619 542.356 219.067 542.356H208.784C208.233 542.356 207.786 541.909 207.786 541.358V537.654C207.786 533.052 204.055 529.322 199.454 529.322C194.852 529.322 191.122 533.052 191.122 537.654V541.358C191.122 541.909 190.674 542.356 190.123 542.356H179.841C179.289 542.356 178.842 541.909 178.842 541.358V537.654C178.842 533.052 175.111 529.322 170.509 529.322C165.908 529.322 162.177 533.053 162.177 537.654V541.358C162.177 541.909 161.73 542.356 161.178 542.356H150.897C150.345 542.356 149.898 541.909 149.898 541.358V537.654C149.898 533.053 146.168 529.322 141.566 529.322C136.964 529.322 133.233 533.052 133.233 537.654V541.358C133.233 541.909 132.786 542.356 132.234 542.356H121.952C121.401 542.356 120.954 541.909 120.954 541.358V537.654C120.954 533.053 117.223 529.322 112.622 529.322C108.02 529.322 104.289 533.052 104.289 537.654V541.358C104.289 541.909 103.841 542.356 103.29 542.356H93.0081C92.4564 542.356 92.0093 541.909 92.0093 541.358V537.654C92.0092 533.052 88.2791 529.322 83.6772 529.322C79.0754 529.322 75.3452 533.052 75.3452 537.654V541.358C75.3452 541.909 74.898 542.356 74.3464 542.356H64.0637C63.5121 542.356 63.0649 541.909 63.0649 541.358V537.654C63.0649 533.052 59.3347 529.322 54.7329 529.322C50.1311 529.322 46.4009 533.052 46.4009 537.654V541.358C46.4009 541.909 45.9537 542.356 45.4021 542.356H33.578C33.1675 542.356 32.8433 542.012 32.8433 541.602V525.813C32.8432 518.452 27.1743 512.414 19.9639 511.827C19.4186 511.783 18.9771 511.341 18.9771 510.794V49.659C18.9771 49.112 19.4186 48.6704 19.9639 48.6261C27.1742 48.0391 32.8431 42.0032 32.8433 34.6416V18.8535C32.8433 18.3779 33.2168 17.9766 33.6925 17.9766H45.4763C46.0279 17.9766 46.4751 18.4237 46.4751 18.9753V22.7998Z"
                fill="white"
              />
            </Mask>
          </Defs>
          <G filter="url(#filter0_dd_4758_712)" mask="url(#mask0_4758_712)">
            <Rect
              x="0"
              y="0"
              width="340"
              height="566"
              fill="url(#pattern0_4758_712)"
            />
          </G>
        </Svg>
      </Pressable>

      {/* 영화 정보 레이어 - 마스크 영역에만 겹침 */}
      {displayMode === 'detail' && (
        <Pressable
          style={styles.detailOverlay}
          onPress={() => {
            setDisplayMode('poster');
          }}
        >
          <View
            style={{
              flex: 1,
              borderWidth: 0.8,
              borderColor: 'black',
            }}
          >
            <ScrollView
              style={styles.detailContent}
              contentContainerStyle={styles.detailContentContainer}
              showsVerticalScrollIndicator={false}
            >
              <Text style={styles.movieTitle}>
                {movie?.name || '제목 없음'}
              </Text>
              <Text style={styles.keywords}>
                {movie?.keywords && movie.keywords.length > 0
                  ? `${movie.keywords.join(', ')}`
                  : '키워드 정보가 없습니다.'}
              </Text>
              <View
                style={{
                  display: 'flex',
                  flexDirection: 'row',
                  alignItems: 'center',
                  gap: 10,
                }}
              >
                <Text
                  style={{
                    fontSize: 12,
                    fontFamily: 'Pretendard-Bold',
                    color: '#0E2B43',
                  }}
                >
                  감독
                </Text>
                <Text style={styles.movieInfo}>{movie?.director || '-'}</Text>
              </View>
              <View
                style={{
                  display: 'flex',
                  flexDirection: 'row',
                  alignItems: 'center',
                  gap: 10,
                }}
              >
                <Text
                  style={{
                    fontSize: 12,
                    fontFamily: 'Pretendard-Bold',
                    color: '#0E2B43',
                  }}
                >
                  출연
                </Text>
                <Text style={styles.movieInfo}>{movie?.cast || '-'}</Text>
              </View>
              <View
                style={{
                  height: 1,
                  backgroundColor: 'black',
                  marginVertical: 16,
                }}
              ></View>
              <ScrollView
                style={{
                  flex: 1,
                }}
              >
                <Text style={styles.movieSummary}>
                  {movie?.summary || '줄거리 정보가 없습니다.'}
                </Text>
              </ScrollView>
            </ScrollView>
          </View>
          <Text
            style={{
              fontSize: 12,
              fontFamily: 'GalmuriMono9',
              color: '#F8F5CC',
              paddingTop: 12,
              lineHeight: 22,
              textAlign: 'center',
            }}
          >
            영화앤미
          </Text>
        </Pressable>
      )}
      <Svg
        width="340"
        height="566"
        viewBox="0 0 340 566"
        fill="none"
        style={{ position: 'absolute', top: 29, left: 12, zIndex: 1 }}
      >
        <Defs>
          <Filter
            id="filter0_dd_4758_712"
            x="0.00021553"
            y="-0.00149155"
            width="339.674"
            height="565.329"
            filterUnits="userSpaceOnUse"
          >
            <FeFlood floodOpacity="0" result="BackgroundImageFix" />
            <FeColorMatrix
              in="SourceAlpha"
              type="matrix"
              values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
              result="hardAlpha"
            />
            <FeOffset dx="0.998781" />
            <FeGaussianBlur stdDeviation="8.98903" />
            <FeComposite in2="hardAlpha" operator="out" />
            <FeColorMatrix
              type="matrix"
              values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0"
            />
            <FeBlend
              mode="multiply"
              in2="BackgroundImageFix"
              result="effect1_dropShadow_4758_712"
            />
            <FeColorMatrix
              in="SourceAlpha"
              type="matrix"
              values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
              result="hardAlpha"
            />
            <FeOffset dy="3.99512" />
            <FeGaussianBlur stdDeviation="9.48842" />
            <FeComposite in2="hardAlpha" operator="out" />
            <FeColorMatrix
              type="matrix"
              values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.35 0"
            />
            <FeBlend
              mode="normal"
              in2="effect1_dropShadow_4758_712"
              result="effect2_dropShadow_4758_712"
            />
            <FeBlend
              mode="normal"
              in="SourceGraphic"
              in2="effect2_dropShadow_4758_712"
              result="shape"
            />
          </Filter>
          <Pattern
            id="pattern0_4758_712"
            patternContentUnits="objectBoundingBox"
            width="1"
            height="1"
          >
            <Use
              xlinkHref="#image0_4758_712"
              transform="matrix(0.00121536 0 0 0.000699301 -0.10768 0)"
            />
          </Pattern>
          <Image
            id="image0_4758_712"
            width="1000"
            height="1430"
            preserveAspectRatio="none"
            xlinkHref={require('@assets/images/background_life_of_pi.png')}
          />
          <Mask
            id="mask0_4758_712"
            maskUnits="userSpaceOnUse"
            x="18"
            y="17"
            width="303"
            height="526"
          >
            <Path
              d="M46.4751 22.7998C46.4751 27.4017 50.2063 31.1328 54.8081 31.1328C59.4098 31.1327 63.1401 27.4016 63.1401 22.7998V18.9753C63.1401 18.4237 63.5873 17.9766 64.1389 17.9766H74.4207C74.9723 17.9766 75.4194 18.4237 75.4194 18.9753V22.7998C75.4194 27.4017 79.1506 31.1328 83.7524 31.1328C88.3541 31.1326 92.0845 27.4015 92.0845 22.7998V18.9753C92.0845 18.4237 92.5316 17.9766 93.0833 17.9766H103.365C103.917 17.9766 104.364 18.4237 104.364 18.9753V22.8008C104.364 27.4025 108.095 31.1328 112.697 31.1328C117.298 31.1326 121.029 27.4024 121.029 22.8008V18.9753C121.029 18.4237 121.476 17.9766 122.028 17.9766H132.309C132.861 17.9766 133.308 18.4237 133.308 18.9753V22.8008C133.308 27.4025 137.039 31.1328 141.641 31.1328C146.243 31.1327 149.973 27.4024 149.973 22.8008V18.9753C149.973 18.4237 150.42 17.9766 150.972 17.9766H161.254C161.805 17.9766 162.252 18.4237 162.252 18.9753V22.8008C162.253 27.4025 165.983 31.1328 170.584 31.1328C175.186 31.1327 178.916 27.4025 178.917 22.8008V18.9753C178.917 18.4237 179.364 17.9766 179.915 17.9766H190.198C190.75 17.9766 191.197 18.4237 191.197 18.9753V22.8008C191.197 27.4024 194.927 31.1326 199.529 31.1328C204.131 31.1328 207.862 27.4025 207.862 22.8008V18.9753C207.862 18.4237 208.309 17.9766 208.861 17.9766H219.142C219.694 17.9766 220.141 18.4237 220.141 18.9753V22.8008C220.141 27.4025 223.871 31.1328 228.473 31.1328C233.075 31.1328 236.805 27.4025 236.805 22.8008V18.9753C236.805 18.4237 237.252 17.9766 237.804 17.9766H248.086C248.637 17.9766 249.084 18.4237 249.084 18.9753V22.8008C249.085 27.4025 252.816 31.1328 257.417 31.1328C262.019 31.1326 265.749 27.4024 265.75 22.8008V18.9753C265.75 18.4237 266.197 17.9766 266.748 17.9766H277.03C277.582 17.9766 278.029 18.4237 278.029 18.9753V22.8008C278.029 27.4025 281.76 31.1328 286.362 31.1328C290.963 31.1327 294.694 27.4024 294.694 22.8008V18.9753C294.694 18.4237 295.141 17.9766 295.693 17.9766H307.401C307.877 17.9766 308.251 18.3779 308.251 18.8535V34.6416C308.252 41.5489 313.242 47.2896 319.814 48.4569C320.314 48.5458 320.698 48.9693 320.698 49.4776V510.976C320.698 511.485 320.314 511.908 319.814 511.997C313.242 513.165 308.251 518.906 308.251 525.813V541.602C308.251 542.012 307.926 542.356 307.516 542.356H295.617C295.066 542.356 294.619 541.909 294.619 541.358V537.654C294.619 533.052 290.888 529.321 286.287 529.321C281.685 529.321 277.955 533.052 277.955 537.654V541.358C277.955 541.909 277.507 542.356 276.956 542.356H266.673C266.121 542.356 265.674 541.909 265.674 541.358V537.654C265.674 533.052 261.944 529.321 257.342 529.321C252.74 529.321 249.01 533.052 249.01 537.654V541.358C249.01 541.909 248.563 542.356 248.011 542.356H237.729C237.177 542.356 236.73 541.909 236.73 541.358V537.654C236.73 533.052 233 529.322 228.398 529.322C223.796 529.322 220.066 533.052 220.066 537.654V541.358C220.066 541.909 219.619 542.356 219.067 542.356H208.784C208.233 542.356 207.786 541.909 207.786 541.358V537.654C207.786 533.052 204.055 529.322 199.454 529.322C194.852 529.322 191.122 533.052 191.122 537.654V541.358C191.122 541.909 190.674 542.356 190.123 542.356H179.841C179.289 542.356 178.842 541.909 178.842 541.358V537.654C178.842 533.052 175.111 529.322 170.509 529.322C165.908 529.322 162.177 533.053 162.177 537.654V541.358C162.177 541.909 161.73 542.356 161.178 542.356H150.897C150.345 542.356 149.898 541.909 149.898 541.358V537.654C149.898 533.053 146.168 529.322 141.566 529.322C136.964 529.322 133.233 533.052 133.233 537.654V541.358C133.233 541.909 132.786 542.356 132.234 542.356H121.952C121.401 542.356 120.954 541.909 120.954 541.358V537.654C120.954 533.053 117.223 529.322 112.622 529.322C108.02 529.322 104.289 533.052 104.289 537.654V541.358C104.289 541.909 103.841 542.356 103.29 542.356H93.0081C92.4564 542.356 92.0093 541.909 92.0093 541.358V537.654C92.0092 533.052 88.2791 529.322 83.6772 529.322C79.0754 529.322 75.3452 533.052 75.3452 537.654V541.358C75.3452 541.909 74.898 542.356 74.3464 542.356H64.0637C63.5121 542.356 63.0649 541.909 63.0649 541.358V537.654C63.0649 533.052 59.3347 529.322 54.7329 529.322C50.1311 529.322 46.4009 533.052 46.4009 537.654V541.358C46.4009 541.909 45.9537 542.356 45.4021 542.356H33.578C33.1675 542.356 32.8433 542.012 32.8433 541.602V525.813C32.8432 518.452 27.1743 512.414 19.9639 511.827C19.4186 511.783 18.9771 511.341 18.9771 510.794V49.659C18.9771 49.112 19.4186 48.6704 19.9639 48.6261C27.1742 48.0391 32.8431 42.0032 32.8433 34.6416V18.8535C32.8433 18.3779 33.2168 17.9766 33.6925 17.9766H45.4763C46.0279 17.9766 46.4751 18.4237 46.4751 18.9753V22.7998Z"
              fill="white"
            />
          </Mask>
        </Defs>
        <G filter="url(#filter0_dd_4758_712)" mask="url(#mask0_4758_712)">
          <Rect
            x="0"
            y="0"
            width="340"
            height="566"
            fill="url(#pattern0_4758_712)"
          />
        </G>
      </Svg>
    </View>
  );
};

const styles = StyleSheet.create({
  detailOverlay: {
    position: 'absolute',
    top: 17, // 마스크 y 좌표
    left: 18, // 마스크 x 좌표
    width: 303, // 마스크 width
    height: 526, // 마스크 height
    zIndex: 3,
    paddingTop: 40,
    paddingBottom: 24,
    paddingHorizontal: 10,
  },
  detailContent: {
    width: '100%',
    height: '100%',
    paddingHorizontal: 18,
    paddingVertical: 14,
  },
  detailContentContainer: {
    paddingBottom: 20,
  },
  movieTitle: {
    fontSize: 18,
    fontFamily: 'GalmuriMono9',
    color: '#0E2B43',
    marginBottom: 20,
    textAlign: 'center',
  },
  keywords: {
    fontSize: 12,
    fontFamily: 'GalmuriMono9',
    color: '#0E2B43',
    paddingTop: 10,
    paddingBottom: 14,
  },
  movieInfo: {
    fontSize: 12,
    fontFamily: 'Pretendard-Regular',
    color: '#0E2B43',
  },
  movieSummary: {
    fontSize: 14,
    fontFamily: 'Pretendard-Regular',
    color: '#0E2B43',
    lineHeight: 22,
  },
});

export default ImageMaskViewer;
